package screenState;

import java.awt.Color;
import java.awt.Font;
import java.awt.Graphics2D;
import java.awt.event.KeyEvent;
import java.awt.image.BufferedImage;
import java.util.HashMap;
import java.util.Random;

import javax.swing.JOptionPane;

import audio.AudioPlayer;
import gameObjects.Tank;
import imageObjects.Background;
import main.GameWindow;

public class MenuScreen extends ScreenObject {

	private Random rand = new Random();
	private Background bg, startUpImage;
	private int currentChoice = 0;
	private int currentOptions = 0;
	private String[] options = { "Local Play", "Online Play", "Help", "Settings", "Quit" };
	private String[] gameModes = { "Single Player", "Multi Player", "Practise", "Back" };
	private String[] settings;
	private String[] difficulty = { "Normal Mode", "Easy Mode", "Novice Mode", "Back" };
	private String[] maps = { "Tennis", "Burger", "Hi_Grounds", "Cross_Fire", "Bone_Field", "Random", "Back" };
	private AudioPlayer sfx;
	private Tank[] tanks;
	private BufferedImage tank1Image, tank2Image, helpImage;

	private boolean loading = true;
	private boolean helpScreen = false;;

	public MenuScreen(ScreenObjectHandler soh, AudioPlayer sfx) {
		this.soh = soh;
		this.sfx = sfx;
		settings = new String[] { sfx.isMusicOn()?"Music: On":"Music: Off", sfx.isSoundOn()?"Sound Effects: On":"Sound Effects: Off", "Back" };
		init();
	}

	public void init() {
		startUpImage = new Background("res/startUp.gif");

	}

	private int tick = 0;

	public void update() {
		if (loading) {
			tick++;
			if (tick == 1) {
				bg = new Background("res/menu_bg.gif");
				tanks = new Tank[2];
				tank1Image = GameWindow.LoadImage("res/tank1.png");
				tank2Image = GameWindow.LoadImage("res/tank2.png");
				helpImage = GameWindow.LoadImage("res/help_img.gif");
				tanks[0] = new Tank(600, 800, null, tank1Image, null, 2);
				tanks[0].setVelY(1);
				tanks[1] = new Tank(1200, 50, null, tank2Image, null, 10);
				tanks[1].setVelY(1);
				if (sfx.getClip("powerUp") == null){
					sfx.addAudio("powerUp", "res/sfx/powerUp.wav");
					sfx.addAudio("gunShot", "res/sfx/gunShot.wav");
					sfx.addAudio("tankExplode", "res/sfx/tankExplode.wav");
					sfx.addAudio("bounce", "res/sfx/bounce.wav");
					sfx.addAudio("pop", "res/sfx/pop.wav");
					sfx.addAudio("select", "res/sfx/powerUp.wav");
					sfx.addAudio("navigate", "res/sfx/bounce.wav");
					sfx.addAudio("startUp", "res/sfx/startUp.wav");
				}

			}
			if (tick == GameWindow.secToTicks(1.0)) {
				sfx.play("startUp");
			}
			if (tick >= GameWindow.secToTicks(3.0)) {
				loading = false;
				if (sfx.getClip("bgm") == null){
					sfx.addAudio("bgm", "res/gameBGM.wav");
				}
				sfx.stop("bgm");
				sfx.loop("bgm");
			}
		} else if (!helpScreen) {
			tanks[0].update();
			tanks[1].update();
			for (int i = 0; i < 2; i++) {
				if (tanks[i].getX() > GameWindow.WIDTH && tanks[i].getAngle() == 2) {
					tanks[i].setX(1200);
					tanks[i].setY(50);
					tanks[i].setAngle(10);
				} else if (tanks[i].getY() > GameWindow.HEIGHT && tanks[i].getAngle() == 10) {
					tanks[i].setX(600);
					tanks[i].setY(800);
					tanks[i].setAngle(2);
				}
			}
		}
	}

	public void draw(Graphics2D g) {
		if (loading) {
			startUpImage.draw(g);
		} else if (helpScreen) {
			g.drawImage(helpImage, 75, 120, null);
			g.setFont(new Font(GameWindow.FONTSTYLE, Font.BOLD, 34));
			g.setColor(Color.red);
			g.drawString("Back", 750, 200);
			g.drawString("Navigate using directional keys, select using Enter", 25, GameWindow.HEIGHT - 25);
		} else {
			bg.draw(g);
			// g.setColor(Color.WHITE);
			// g.drawImage(gfx.get("options"), 0, 0, null);
			int tempI;
			tanks[1].draw(g);
			tanks[0].draw(g);

			if (currentOptions == 0) {
				tempI = options.length;
			} else if (currentOptions == 1) {
				tempI = gameModes.length;
			} else {
				tempI = maps.length;
			}
			for (int i = 0; i < tempI; i++) {
				if (i == currentChoice) {
					g.setFont(new Font(GameWindow.FONTSTYLE, Font.BOLD, 34));
					g.setColor(Color.red);

				} else {
					g.setFont(new Font(GameWindow.FONTSTYLE, Font.BOLD, 32));
					g.setColor(Color.white);
				}
				if (currentOptions == 0) {
					g.drawString(options[i], 80, 170 + i * 40);
				} else if (currentOptions == 1) {
					g.drawString(gameModes[i], 80, 170 + i * 40);
				} else if (currentOptions == 2) {
					g.drawString(maps[i], 80, 180 + i * 40);
				} else if (currentOptions == 3) {
					g.drawString(settings[i], 80, 170 + i * 40);
				} else if (currentOptions == 4) {
					g.drawString(difficulty[i], 80, 170 + i * 40);
				}
			}
			g.setColor(Color.white);
			g.setFont(new Font(GameWindow.FONTSTYLE, Font.BOLD, 20));
			g.drawString("Navigate using directional keys, select using Enter", 25, GameWindow.HEIGHT - 25);
		}
	}

	private void select() {
		if (helpScreen) {
			helpScreen = false;
		} else {
			if (currentOptions == 0) {// game choice
				if (currentChoice == 0) {
					currentChoice = 0;
					currentOptions = 1;
					// soh.setScreen(ScreenObjectHandler.GAMESCREEN);
				}
				if (currentChoice == 1) {
					// ssh.setScreen(ScreenObjectHandler.ONLINEGAMESCREEN);
				}
				if (currentChoice == 2) {
					helpScreen = true;
				}
				if (currentChoice == 3) {
					currentOptions = 3;
					currentChoice = 0;
				}
				if (currentChoice == 4) {
					if (JOptionPane.showConfirmDialog(null, "Are you sure?", "Quitting?",
							JOptionPane.YES_NO_OPTION) == JOptionPane.YES_OPTION) {
						System.exit(0);
					}
				}
			} else if (currentOptions == 1) {// mode selection
				currentOptions = 2;
				if (currentChoice == 0) {
					soh.setMode("Single Player");
					soh.setMap("Tennis");
					currentOptions = 4;
				}
				if (currentChoice == 1) {
					soh.setMode("Multi Player");
				}
				if (currentChoice == 2) {
					soh.setMode("Practise");
				}
				if (currentChoice == 3) {
					currentOptions = 0;
				}
				currentChoice = 0;
			} else if (currentOptions == 2) {// map selection
				if (currentChoice >= 0 && currentChoice <= maps.length - 3) {
					soh.setMap(maps[currentChoice]);
					soh.setScreen(ScreenObjectHandler.GAMESCREEN);
				}
				if (currentChoice == maps.length - 2) {
					soh.setMap(maps[rand.nextInt(3)]);
					soh.setScreen(ScreenObjectHandler.GAMESCREEN);
				}
				if (currentChoice == maps.length - 1) {
					currentOptions = 1;
					currentChoice = 0;
				}
			} else if (currentOptions == 3) {// settings
				if (currentChoice == 0) {
					if (settings[0] == "Music: On") {
						settings[0] = "Music: Off";
						sfx.setMusic(false);
						sfx.stop("bgm");
					} else {
						settings[0] = "Music: On";
						sfx.setMusic(true);
						sfx.loop("bgm");
					}
				}
				if (currentChoice == 1) {
					if (settings[1] == "Sound Effects: On") {
						settings[1] = "Sound Effects: Off";
						sfx.setSound(false);
					} else {
						sfx.setSound(true);
						sfx.play("select");
						settings[1] = "Sound Effects: On";
					}
				}
				if (currentChoice == 2) {
					currentChoice = 3;
					currentOptions = 0;
				}

			} else if (currentOptions == 4) {// difficulty
				if (currentChoice == 0) {
					soh.setDifficulty("Normal");
					soh.setScreen(ScreenObjectHandler.GAMESCREEN);
				}
				if (currentChoice == 1) {
					soh.setDifficulty("Easy");
					soh.setScreen(ScreenObjectHandler.GAMESCREEN);
				}
				if (currentChoice == 2) {
					soh.setDifficulty("Novice");
					soh.setScreen(ScreenObjectHandler.GAMESCREEN);
				}
				if (currentChoice == 3) {
					currentOptions = 1;
					currentChoice = 0;
				}

			}
		}
	}

	public void keyPressed(int k) {
		if (!loading) {
			if (k == KeyEvent.VK_ENTER) {
				sfx.play("select");
				select();
			}
			if (k == KeyEvent.VK_UP && !helpScreen) {
				sfx.play("navigate");
				currentChoice--;
				if (currentChoice == -1) {
					if (currentOptions == 0) {
						currentChoice = options.length - 1;
					} else if (currentOptions == 1) {
						currentChoice = gameModes.length - 1;
					} else {
						currentChoice = maps.length - 1;
					}
				}
			}
			if (k == KeyEvent.VK_DOWN && !helpScreen) {
				sfx.play("navigate");
				currentChoice++;
				if (currentOptions == 0) {
					if (currentChoice == options.length) {
						currentChoice = 0;
					}
				} else if (currentOptions == 1) {
					if (currentChoice == gameModes.length) {
						currentChoice = 0;
					}
				} else {
					if (currentChoice == maps.length) {
						currentChoice = 0;
					}
				}
			}
			if (k == KeyEvent.VK_ESCAPE) {
				if (JOptionPane.showConfirmDialog(null, "Are you sure?", "Quitting?",
						JOptionPane.YES_NO_OPTION) == JOptionPane.YES_OPTION) {
					System.exit(0);
				}
			}
		}
	}

	public void keyReleased(int k) {
	}
}
