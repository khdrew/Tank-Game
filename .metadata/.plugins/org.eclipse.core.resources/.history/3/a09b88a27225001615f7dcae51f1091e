package main;

import java.io.*;
import java.net.*;
import java.util.Scanner;

public class TCPClient {
	public static String fromServer;
	
	public static Socket s;
	
	// Receiver
	private static class Receiver implements Runnable {
		private  BufferedReader serverInput;
		
		private void init() throws IOException{
			serverInput = new BufferedReader(new InputStreamReader(s.getInputStream()));
		}
		
		public void run(){
			try {
				init();
			} catch (IOException e1) {
				// TODO Auto-generated catch block
				e1.printStackTrace();
			}
			
			while (true) {
				try {
					fromServer = serverInput.readLine();
				} catch (IOException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
				}
				
				if (fromServer.toLowerCase() == "quit"){
					try {
						s.close();
					} catch (IOException e) {
						// TODO Auto-generated catch block
						e.printStackTrace();
					}
					break;
				} else {
					System.out.println("RECEIVED: " + fromServer);
				}
				
			}
		}
	}
	
	// Sender
	private static class Sender implements Runnable {
		private Scanner reader;
		private String toServer;
		
		private BufferedReader userInput;
		
		private PrintWriter userOutput;
		
		private void init() throws IOException{
			userInput =  new BufferedReader(new InputStreamReader(System.in));
			userOutput = new PrintWriter(s.getOutputStream(),true);
		}
		
		public void run(){
			try {
				init();
			} catch (IOException e1) {
				// TODO Auto-generated catch block
				e1.printStackTrace();
			}
			
			while (true) {
				System.out.println("SEND: ");
				
				try {
					toServer = userInput.readLine();
				} catch (IOException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
				}
				
				userOutput.println(toServer);
			}
		}
	}
	
	
	public static void main(String argv[]) throws Exception {
		s = new Socket("0.0.0.0", 1121);
		
		Thread receiver = new Thread(new Receiver());
		Thread sender = new Thread(new Sender());
		
		System.out.println("Treads created");
		
		receiver.start();
		sender.start();

		System.out.println("Treads started");
	}
}